
{% extends "base.html" %}
{% block content %}
<div class="max-w-2xl mx-auto bg-white/10 p-4 rounded">
  <h3 class="text-xl mb-2">دردشة خاصة مع {{ other.username }}</h3>
  <div id="pmessages" class="messages mb-3">
    {% for m in messages %}
      <div class="msg"><strong>{{ m.sender }}:</strong> {{ m.text }}</div>
    {% endfor %}
  </div>
  <div class="flex gap-2">
    <input id="pm_input" class="flex-1 p-2 rounded text-black" placeholder="اكتب رسالة...">
    <button id="pm_send" class="py-2 px-4 bg-gradient-to-r from-sky-400 to-purple-500 rounded">إرسال</button>
  </div>
</div>
<script>
const socket = io();
const TO = "{{ other.username }}";
document.getElementById('pm_send').addEventListener('click', ()=>{
  const t = document.getElementById('pm_input'); if(!t.value) return;
  socket.emit('private_message',{to:TO,text:t.value});
  const box = document.getElementById('pmessages');
  const el = document.createElement('div'); el.className='msg'; el.innerHTML='<strong>انت:</strong> '+t.value; box.appendChild(el); t.value=''; box.scrollTop=box.scrollHeight;
});
socket.on('private_message', data => {
  if(data.to== "{{ current_user.username }}" || data.from== "{{ current_user.username }}"){
    const box = document.getElementById('pmessages');
    const el = document.createElement('div'); el.className='msg'; el.innerHTML='<strong>'+data.from+':</strong> '+data.text; box.appendChild(el); box.scrollTop=box.scrollHeight;
  }
});
</script>
{% endblock %}
